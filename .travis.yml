---
dist: trusty
language: rust
rust:
  - stable
  - beta
  - nightly
env:
  # Combinations of optional features
  - FEATURES=''
  - FEATURES='tokio'
  - FEATURES='quickcheck'
  - FEATURES='tokio quickcheck'

matrix:
  include:
    # Run build on oldest supported rust version with all features enabled.
    - rust: 1.17.0
      env: FEATURES='tokio quickcheck'
      after_success:
        - |
            pip install 'travis-cargo<0.2' --user &&
            export PATH=$HOME/.local/bin:$PATH
        - travis-cargo doc -- --lib --features "$FEATURES" --no-deps
        - travis-cargo doc-upload

script:
  - cargo build --verbose --features "$FEATURES"
  - cargo test --verbose --features "$FEATURES"

cache: cargo
before_cache:
  # Travis can't cache files that are not readable by "others"
  - chmod -R a+r $HOME/.cargo
